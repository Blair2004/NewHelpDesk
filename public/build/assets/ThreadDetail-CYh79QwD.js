import{u as j,g as f,h as F,i as L,A as Y,c as r,j as y,e as o,a as e,t as d,p as _,b as K,w as U,T as O,x as A,q as b,y as P,B as R,v as q,s as z,F as g,l as w,o as n,C as E}from"./app-4HU7gmEH.js";import{u as G}from"./thread-HO_BQTKl.js";import{h as H}from"./moment-C5S46NFB.js";const I=(v,u)=>{const s=v.__vccOpts||v;for(const[c,i]of u)s[c]=i;return s},J={key:0,class:"flex h-full"},Q={class:"flex-1 flex flex-col"},W={class:"bg-white border-b p-4"},X={class:"flex justify-between items-start"},Z={class:"text-2xl font-bold"},$={class:"text-sm text-gray-600 mt-1"},ee={class:"flex items-center mb-2"},te=["src"],se={class:"text-sm font-medium"},ae={class:"text-xs ml-2 opacity-75"},oe={class:"whitespace-pre-wrap"},le={key:0,class:"mt-2 space-y-2"},re=["src","alt"],ne={key:0,class:"bg-white border-t p-4"},de=["onKeydown"],ie={key:1,class:"bg-yellow-50 border-t p-4 text-center text-sm text-yellow-800"},ue={class:"w-80 bg-white border-l p-6 overflow-y-auto"},ce={class:"space-y-4"},me={class:"text-gray-700"},pe={class:"text-gray-700"},he={key:0},fe={class:"flex items-center"},ve={class:"space-y-2"},xe=["src"],ye={class:"text-sm"},_e={__name:"ThreadDetail",setup(v){const u=L(),s=G(),c=j(),i=f(null),m=f(""),p=f(""),h=f(!1);F(async()=>{await s.fetchThread(u.params.id),p.value=s.currentThread.status,h.value=s.currentThread.is_locked,C()}),Y(()=>{var l;return(l=s.currentThread)==null?void 0:l.messages},()=>{E(()=>C())},{deep:!0});async function T(){if(m.value.trim())try{await s.sendMessage(u.params.id,{content:m.value}),m.value=""}catch(l){console.error("Failed to send message:",l)}}async function k(){try{await s.updateThread(u.params.id,{status:p.value,is_locked:h.value})}catch(l){console.error("Failed to update thread:",l)}}function C(){i.value&&(i.value.scrollTop=i.value.scrollHeight)}function B(l){return H(l).format("MMM D, YYYY h:mm A")}function N(l){const t={open:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",resolved:"bg-blue-100 text-blue-800",closed:"bg-gray-100 text-gray-800"};return t[l]||t.open}return(l,t)=>{var M;return o(s).currentThread?(n(),r("div",J,[e("div",Q,[e("div",W,[e("div",X,[e("div",null,[e("h1",Z,d(o(s).currentThread.title),1),e("p",$," Created by "+d(o(s).currentThread.owner.name),1)]),e("span",{class:_([N(o(s).currentThread.status),"px-3 py-1 text-sm rounded"])},d(o(s).currentThread.status),3)])]),e("div",{ref_key:"messagesContainer",ref:i,class:"flex-1 overflow-y-auto p-6 space-y-4"},[K(O,{name:"message"},{default:U(()=>[(n(!0),r(g,null,w(o(s).currentThread.messages,a=>{var S,D,V;return n(),r("div",{key:a.id,class:_(["flex",a.author.id===((S=o(c).user)==null?void 0:S.id)?"justify-end":"justify-start"])},[e("div",{class:_(["max-w-xl p-4 rounded-lg",a.author.id===((D=o(c).user)==null?void 0:D.id)?"bg-blue-600 text-white":"bg-white border"])},[e("div",ee,[e("img",{src:a.author.avatar||"/default-avatar.png",alt:"Avatar",class:"w-6 h-6 rounded-full mr-2"},null,8,te),e("span",se,d(a.author.name),1),e("span",ae,d(B(a.created_at)),1)]),e("p",oe,d(a.content),1),(V=a.attachments)!=null&&V.length?(n(),r("div",le,[(n(!0),r(g,null,w(a.attachments,x=>(n(),r("img",{key:x.id,src:x.url,alt:x.filename,class:"rounded max-w-sm"},null,8,re))),128))])):y("",!0)],2)],2)}),128))]),_:1})],512),o(s).currentThread.is_locked?(n(),r("div",ie," This thread is locked. No new messages can be added. ")):(n(),r("div",ne,[e("form",{onSubmit:A(T,["prevent"]),class:"flex space-x-4"},[b(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=a=>m.value=a),placeholder:"Type your message...",rows:"3",class:"input flex-1",onKeydown:R(A(T,["ctrl"]),["enter"])},null,40,de),[[P,m.value]]),t[3]||(t[3]=e("button",{type:"submit",class:"btn btn-primary self-end"},"Send",-1))],32)]))]),e("div",ue,[t[10]||(t[10]=e("h3",{class:"font-semibold mb-4"},"Thread Details",-1)),e("div",ce,[e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium mb-2"},"Status",-1)),b(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>p.value=a),onChange:k,class:"input"},[...t[4]||(t[4]=[e("option",{value:"open"},"Open",-1),e("option",{value:"pending"},"Pending",-1),e("option",{value:"resolved"},"Resolved",-1),e("option",{value:"closed"},"Closed",-1)])],544),[[q,p.value]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium mb-2"},"Category",-1)),e("p",me,d(((M=o(s).currentThread.category)==null?void 0:M.name)||"None"),1)]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium mb-2"},"Locale",-1)),e("p",pe,d(o(s).currentThread.locale),1)]),o(c).isStaff?(n(),r("div",he,[e("label",fe,[b(e("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=a=>h.value=a),onChange:k,class:"mr-2"},null,544),[[z,h.value]]),t[8]||(t[8]=e("span",{class:"text-sm"},"Lock thread",-1))])])):y("",!0),e("div",null,[t[9]||(t[9]=e("h4",{class:"font-medium mb-2"},"Participants",-1)),e("div",ve,[(n(!0),r(g,null,w(o(s).currentThread.participants,a=>(n(),r("div",{key:a.id,class:"flex items-center"},[e("img",{src:a.avatar||"/default-avatar.png",alt:"Avatar",class:"w-8 h-8 rounded-full mr-2"},null,8,xe),e("span",ye,d(a.name),1)]))),128))])])])])])):y("",!0)}}},Te=I(_e,[["__scopeId","data-v-6f3ff4fa"]]);export{Te as default};
